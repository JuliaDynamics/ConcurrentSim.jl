<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Resource API · ConcurrentSim</title><meta name="title" content="Resource API · ConcurrentSim"/><meta property="og:title" content="Resource API · ConcurrentSim"/><meta property="twitter:title" content="Resource API · ConcurrentSim"/><meta name="description" content="Documentation for ConcurrentSim."/><meta property="og:description" content="Documentation for ConcurrentSim."/><meta property="twitter:description" content="Documentation for ConcurrentSim."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ConcurrentSim</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><span class="tocitem">Topical Guides</span><ul><li><a class="tocitem" href="../basics/">Basics</a></li><li><a class="tocitem" href="../environments/">Environments</a></li><li><a class="tocitem" href="../events/">Events</a></li><li class="is-active"><a class="tocitem" href>Resource API</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/ross/">Ross</a></li><li><a class="tocitem" href="../../examples/Latency/">Latency</a></li><li><a class="tocitem" href="../../examples/mmc/">Multi-server Queue</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Topical Guides</a></li><li class="is-active"><a href>Resource API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Resource API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/ConcurrentSim.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDynamics/ConcurrentSim.jl/blob/master/docs/src/guides/blockingandyielding.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Blocking-and-Yielding-Resource-API"><a class="docs-heading-anchor" href="#Blocking-and-Yielding-Resource-API">Blocking and Yielding Resource API</a><a id="Blocking-and-Yielding-Resource-API-1"></a><a class="docs-heading-anchor-permalink" href="#Blocking-and-Yielding-Resource-API" title="Permalink"></a></h1><p>The goal of this page is to list the most common synchronization and resource management patterns used in <code>ConcurrentSim.jl</code> simulations and to briefly compare them to Julia&#39;s base capabilities for asynchronous and parallel programming.</p><p>There are many different approaches to discrete event simulation in particular and to asynchronous and parallel programming in general. This page assumes some rudimentary understanding of concurrency in programming. While not necessary, you are encouraged to explore the following resources for a more holistic understanding:</p><ul><li>&quot;concurrency&quot; vs &quot;parallelism&quot; - see <a href="https://stackoverflow.com/questions/1050222/what-is-the-difference-between-concurrency-and-parallelism">stackoverflow.com</a> on the topic;</li><li>&quot;threads&quot; vs &quot;tasks&quot;: A task is the actual piece of work, a thread is the &quot;runway&quot; on which a task runs. You can have more tasks than threads and you can even have tasks that jump between threads - see Julia&#39;s <a href="https://docs.julialang.org/en/v1/manual/parallel-computing/">parallel programming documentation</a> (in particular the <a href="https://docs.julialang.org/en/v1/manual/asynchronous-programming/">async</a> and <a href="https://docs.julialang.org/en/v1/manual/multi-threading/">multithreading</a> docs), and multiple Julia blog post on <a href="https://julialang.org/blog/2019/07/multithreading/">multithreading</a> and <a href="https://julialang.org/blog/2023/07/PSA-dont-use-threadid/">its misuses</a>;</li><li>&quot;locks&quot; used to guard (or synchronize) the access to a given resource: i.e. one threads locks an array while modifying it in order to ensure that another thread will not be modifying it at the same time. Julia&#39;s <code>Base</code> multithreading capabilities provide a <code>ReentrantLock</code>, together with a <code>lock</code>, <code>trylock</code>, <code>unlock</code>, and <code>islocked</code> API;</li><li>&quot;channels&quot; used to organize concurrent tasks. Julia&#39;s <code>Base</code> multithreading capabilities provide <code>Channel</code>, together with <code>take!</code>, <code>put!</code>, <code>isready</code>;</li><li>knowing of the <a href="https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/">&quot;red/blue-colored functions&quot; metaphor</a> can be valuable as well as learning of &quot;promises&quot; and &quot;futures&quot;.</li></ul><p>Programming discrete event simulations can be very similar to async parallel programming, except for the fact that in the simulation the &quot;time&quot; is fictitious (and tracking it is a big part of the value proposition in the simulation software). On the other hand, in usual parallel programming the goal is simply to do as much work as possible in the shortest (actual) time. In that context, one possible use of discrete event simulations is to cheaply model and optimize various parallel implementations of actual expensive algorithms (whether numerical computer algorithms or the algorithms used to schedule a real factory or a fleet of trucks).</p><p>In particular, the <code>ConcurrentSim.jl</code> package uses the async &quot;coroutines&quot; model of parallel programing. <code>ConcurrentSim</code> uses the <code>ResumableFunctions.jl</code> package to build its coroutines, which uses the <code>@resumable</code> macro to mark a function as an &quot;async&quot; coroutine and the <code>@yield</code> macro to yield between coroutines.</p><div class="admonition is-warning"><header class="admonition-header">Base Julia coroutines vs ConcurrentSim coroutines</header><div class="admonition-body"><p>The <code>ConcurrentSim</code> and <code>ResumableFunctions</code> coroutines are currently incompatible with Julia&#39;s base coroutines (which based around <code>wait</code> and <code>fetch</code>). A separate coroutines implementation was necessary, because Julia&#39;s coroutines are designed for computationally heavy tasks and practical parallel algorithms, leading to significant overhead when they are used with extremely large numbers of computationally cheap tasks, as it is common in discrete event simulators. <code>ResumableFunctions</code>&#39;s coroutines are single threaded but with drastically lower call overhead. A future long-term goal of ours is to unify the API used by <code>ResumableFunctions</code> and base Julia, but this will not be achieved in the near term, hence the need for pages like this one.</p></div></div><p>Without further ado, here is the typical API used with:</p><ul><li><code>ConcurrentSim.Resource</code> which is used to represent scarce resource that can be used by only up to a fixed number of tasks. If the limit is just one task (the default), this is very similar to <code>Base.ReentrantLock</code>. <code>Resource</code> is a special case of <code>Container</code> with an integer &quot;resource counter&quot;.</li><li><code>ConcurrentSim.Store</code> which is used to represent an unordered heap. For the ordered versions, consider <code>QueueStore</code> or <code>StackStore</code>.</li></ul><div style="width:120%;min-width:120%;"><table><tr><th style="text-align: right"></th><th style="text-align: left"><code>Base</code> <code>ReentrantLock</code></th><th style="text-align: left"><code>Base</code> <code>Channel</code></th><th style="text-align: left"><code>ConcurrentSim</code> <code>Container</code></th><th style="text-align: left"><code>ConcurrentSim</code> <code>Resource</code>, i.e. <code>Container{Int}</code></th><th style="text-align: left"><code>ConcurrentSim</code> <code>Store</code></th><th style="text-align: center"></th></tr><tr><td style="text-align: right"><code>put!</code></td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">@yield</td><td style="text-align: left">@yield</td><td style="text-align: left">@yield</td><td style="text-align: center">low-level &quot;put an object in&quot; API</td></tr><tr><td style="text-align: right"><code>take!</code></td><td style="text-align: left">❌</td><td style="text-align: left">block</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">@yield</td><td style="text-align: center">the <code>Channel</code>-like API for <code>Store</code></td></tr><tr><td style="text-align: right"><code>lock</code></td><td style="text-align: left">block</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">@yield</td><td style="text-align: left">❌</td><td style="text-align: center">the <code>Lock</code>-like API for <code>Resource</code> (there is also <code>trylock</code>)</td></tr><tr><td style="text-align: right"><code>unlock</code></td><td style="text-align: left">✔️</td><td style="text-align: left">❌</td><td style="text-align: left">❌</td><td style="text-align: left">@yield</td><td style="text-align: left">❌</td><td style="text-align: center">the <code>Lock</code>-like API for <code>Resource</code></td></tr><tr><td style="text-align: right"><code>isready</code></td><td style="text-align: left">❌</td><td style="text-align: left">✔️</td><td style="text-align: left">✔️</td><td style="text-align: left">✔️</td><td style="text-align: left">✔️</td><td style="text-align: center">something is stored in the resource</td></tr><tr><td style="text-align: right"><code>islocked</code></td><td style="text-align: left">✔️</td><td style="text-align: left">❌</td><td style="text-align: left">✔️</td><td style="text-align: left">✔️</td><td style="text-align: left">✔️</td><td style="text-align: center">the resource can not store anything more</td></tr></table></div><p>The table denotes which methods exist (✔️), are blocking (block), need to be explicitly yielded with <code>ResumableFunctions</code> (@yield), or are not applicable (❌).</p><p>As you can see <code>Resource</code> shares some properties with <code>ReentrantLock</code> and avails itself of the <code>lock</code>/<code>unlock</code>/<code>trylock</code> Base API. <code>Store</code> similarly shares some properties with <code>Channel</code> and shares the <code>put!</code>/<code>take!</code> Base API. Of note is that when the Base API would be blocking, the corresponding <code>ConcurrentSim</code> methods actually give coroutines that need to be <code>@yield</code>-ed.</p><p><code>take!</code> and <code>unlock</code> are both implemented on top of the lower level <code>get</code>.</p><p>The <code>Base.lock</code> and <code>Base.unlock</code> are aliased to <code>ConcurrentSim.request</code> and <code>ConcurrentSim.release</code> respectively for semantic convenience when working with <code>Resource</code>. </p><p><code>unlock(::Resource)</code> is instantaneous so the <code>@yield</code> is not strictly necessary. Similarly for <code>put!(::Store)</code> if the store has infinite capacity.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../events/">« Events</a><a class="docs-footer-nextpage" href="../../examples/ross/">Ross »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Monday 3 June 2024 16:16">Monday 3 June 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
